---
title: "Heart Attact"
author: "Tymoteusz Romanowicz, Patryk Tokarski"
format: html
editor: visual
embed-resources: true
---

Opis: Finding a good data source is the first step toward creating a database. Cardiovascular illnesses (CVDs) are the major cause of death worldwide. CVDs include coronary heart disease, cerebrovascular disease, rheumatic heart disease, and other heart and blood vessel problems. According to the World Health Organization, 17.9 million people die each year. Heart attacks and strokes account for more than four out of every five CVD deaths, with one-third of these deaths occurring before the age of 70. A comprehensive database for factors that contribute to a heart attack has been constructed. The main purpose here is to collect characteristics of Heart Attack or factors that contribute to it. The size of the dataset is 1319 samples, which have nine fields, where eight fields are for input fields and one field for an output field. Age, gender, heart rate (impulse), systolic BP (pressurehight), diastolic BP (pressurelow), blood sugar(glucose), CK-MB (kcm), and Test-Troponin (troponin) are representing the input fields, while the output field pertains to the presence of heart attack (class), which is divided into two categories (negative and positive); negative refers to the absence of a heart attack, while positive refers to the presence of a heart attack.

1.  Przedstawienie zbioru danych

    1.  Źródło danych

        1.  Zawartość zbioru: informacja o ilości danych, kiedy zostały zebrane\

        2.  Przedstawienie zmiennych: opis jakie są i co znaczą\

            | Cecha                    | Opis                                                                                                 |
            |------------------|------------------------------------------------------|
            | Age                      | Wiek pacjenta w latach                                                                               |
            | Gender                   | Płeć pacjenta (0 - kobieta, 1 - mężczyzna)                                                           |
            | Heart Rate               | Maksymalne osiągnięte tętno (od 10 do 160)                                                           |
            | Systolic blood pressure  | Spoczynkowe skurczowe ciśnienie krwi (w mm Hg, podczas dojazdu do szpitala) (70-190)                 |
            | Diastolic blood pressure | Spoczynkowe rozkurczowe ciśnienie krwi (w mm Hg, podczas dojazdu do szpitala) (40-100)               |
            | Blood sugar              | Poziom cukru we krwi (1-900mg/dl) #TODO na wiki jest że do ponad 200 poziom                          |
            | CK-MB                    | Enzym CK-MB (mężczyźni do 6,22, kobiety do 4,88). Jest to enzym kinazy kreatynowej.                  |
            | Troponin                 | Enzym troponiny (0,0 - 0,014) #TODO wartosc graniczna (odkad mozna podejrzewa chorobe serca) od 0,03 |

            : Cechy i ich opisy

2.  Cele badawcze - sprawdzenie, jakie czynniki mają wpływ na wystąpienie udaru u człowieka\
    \

3.  Przygotowanie zbioru / weryfikacja poprawnosci danych / brakujace wartosci - caly kod którym porządkujemy dane, zmieniamy wartosci na factor, może dzielimy wiek na sekcje (18-25, 26-50)\
    \

4.  Opis zbioru / statystyczna analiza opisowa - summary, statystyki opisowe\
    \

5.  Wizualizacja - ...\
    \

6.  Analiza korespondencji - *sprawdzic czy nam to potrzebne* <https://www.statsoft.pl/textbook/stathome_stat.html?https%3A%2F%2Fwww.statsoft.pl%2Ftextbook%2Fstcoran.html>\
    \

7.  Model

    1.  Wybór modelu - wypisac ktory moze byc najlepszy

    2.  stworzenie modelu

    3.  przetrenowanie modelu

    4.  testowanie modelu

    5.  Podsumowanie efektywności modelu / jego przydatności\
        \

8.  Odpowiedź na pytania badawcze i podsumowanie\
    \

Pierwsze 6 wierszy:

```{r}
library(tidyverse)
library(foreign)

df <- read.arff("data/Medicaldataset.arff")
df <- df %>% rename(
  "Age" = age,
  "Gender" = gender,
  "Heart Rate" = impluse,
  "Systolic.blood.pressure" = pressurehight,
  "Diastolic.blood.pressure" = pressurelow,
  "Blood.sugar" = glucose,
  "CK.MB" = kcm,
  "Troponin" = troponin,
  "Result" = class
)
```

```{r}
head(df)

```

```{r}
# przedstawienie result jako zmiennej jakościowej
df$Result <- as.factor(df$Result)
df$Gender <- as.factor(df$Gender)
summary(df)
```

Wykrycie obserwacji odstających:

```{r}
library(rstatix)
names(df)
zmienne <- c("Age", "Diastolic.blood.pressure")
identify_outliers(df["Troponin"])

```

```{r}
library(corrplot)
library(knitr)
library(PerformanceAnalytics)

chart.Correlation(df[,c(1,3:8)])
corrplot(cor(df[,c(1,3:8)]))
```

```{r}
df$Result <- ifelse(df$Result == "positive", 1, 0)
head(df) 
```

#TODO Przeniesc Czyszczenie

```{r}
df <- df[df$`Heart Rate` != 1111, ]
head(df)
```

```{r}
tail(df[df$CK.MB>=300, ])
```

```{r}
df[c(-1,-2,-9)] <- df[c(-1,-2,-9)] %>% scale()
model <- glm(Result~.-Blood.Sugar, family = 'binomial', data = df[, -c(3:5)])
summary(model)
```

```{r}
probs <- predict(model, newdata = df[, -c(3:5)], type = "response")
pred <- rep(0, length(probs))
pred[probs > .5] <- 1

table(pred, df$Result)
```

Dalex - paczka do wyjasniania modelu

```{r}
library(DALEX)
explainer <- explain(model, data = df[-9], y = df[9])
explainer %>% feature_importance() %>% plot()
explainer %>% model_performance()  %>% plot()
explainer %>% model_performance()
```

install.packages("devtools")

devtools::install_github("ModelOriented/ArenaR")

install.packages("arenar")

```{r}
library(arenar)
heart_attack_ar <- create_arena(live = TRUE) %>% 
  push_model(explainer) %>% 
  push_observations(df)
run_server(heart_attack_ar)
```
